<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta content="width=device-width, initial-scale=1.0" name="viewport" />

		<title>Food Vault - Sign in</title>
		<meta content="" name="description" />
		<meta content="" name="keywords" />

		<script src="https://unpkg.com/bcryptjs@2.4.3/dist/bcrypt.js"></script>

		<!-- The core Firebase JS SDK is always required and must be listed first -->
		<script
			type="module"
			src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"
		></script>
		<!-- This is the API from Firebase Realtime Database -->
		<script
			type="module"
			src="https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js"
		></script>

		<!-- Favicons -->
		<link href="./assets/img/Logo/bar-icon.jpg" sizes="32x32" rel="icon" />

		<!-- Axios-->
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

		<!-- Google Fonts -->
		<link
			href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
			rel="stylesheet"
		/>

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">

		<!-- Vendor CSS Files -->
		<link href="assets/vendor/aos/aos.css" rel="stylesheet" />
		<link
			href="assets/vendor/bootstrap/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
			rel="stylesheet"
		/>
		<link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
		<link
			href="assets/vendor/glightbox/css/glightbox.min.css"
			rel="stylesheet"
		/>
		<link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
		<link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

		<!-- Template Main CSS File -->
		<link href="assets/css/style.css" rel="stylesheet" />

		<!-- Vue.js -->
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

		<!-- Recaptcha -->
		<script src="https://unpkg.com/vue-recaptcha@latest/dist/vue-recaptcha.min.js"></script>
		<script
			src="https://www.google.com/recaptcha/api.js?onload=vueRecaptchaApiLoaded&render=explicit"
			async
			defer
		></script>

		<style>
			.mt-2 {
				font-size: 30px;
			}

			.icon,
			.icon2 {
				font-size: 2rem;
			}

			input {
				font: inherit;
				outline: 0;
			}

			.form__input {
				border-radius: 0.25em;
				border-style: solid;
				width: 70%;
				padding: 0.5em 4em 0.5em 2em;
			}

			small {
				color: red;
				display: none;
			}

			.form_val .empty ~ small {
				display: block;
			}

			form {
				height: fit-content;
				width: 50%;
				background-color: #f8f8f8;
				padding-left: 5em;
			}

			.form_val .recaptcha_fail small {
				display: block;
			}

			span{
				position: relative;
				right: 30px
			}

			@media screen and (max-width: 747px) {
				.mt-2 {
					font-size: 20px;
				}

				h5 {
					font-size: 15px;
				}

				input {
					width: 70%;
				}

				form {
					width: 60%;
					padding-left: 3em;
				}
			}

			@media screen and (max-width: 500px) {
				.mt-2 {
					font-size: 18px;
				}

				h5 {
					font-size: 14px;
				}

				input {
					width: 70%;
				}

				small {
					font-size: 12px;
				}

				form {
					width: 70%;
					padding-left: 2em;
				}
			}

			@media screen and (max-width: 400px) {
				form {
					width: 100%;
					padding-left: 1em;
				}
			}
		</style>
	</head>

	<body>
		<!-- ======= Header ======= -->
		<header id="header" class="fixed-top d-flex align-items-center">
			<div class="container d-flex align-items-center justify-content-between">
				<div class="logo">
					<h1><a href="./foodvault_intro_v2.html">Food Vault</a></h1>
					<!-- Uncomment below if you prefer to use an image logo -->
					<!-- <a href="index.html"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->
				</div>
				<nav id="navbar" class="navbar">
					<ul>
						<li>
							<a class="nav-link scrollto" href="./foodvault_intro_v2.html#app"
								>Home</a
							>
						</li>
						<li>
							<a
								class="nav-link scrollto"
								href="./foodvault_intro_v2.html#about"
								>About</a
							>
						</li>
						<!-- <li><a class="nav-link scrollto" href="#services"></a></li> -->
						<li>
							<a class="nav-link scrollto" href="./foodvault_intro_v2.html#team"
								>Team</a
							>
						</li>
						<li>
							<a class="nav-link scrollto" href="./foodvault_intro_v2.html#faq"
								>FAQ</a
							>
						</li>
						<li class="nav-item dropdown">
							<a
								class="nav-link scrollto dropdown-toggle"
								href="#services"
								id="navbarDropdownMenuLink"
								role="button"
								data-bs-toggle="dropdown"
								aria-expanded="false"
							>
								Services
							</a>
							<ul
								class="dropdown-menu"
								aria-labelledby="navbarDropdownMenuLink"
							>
								<li><a class="dropdown-item" href="./learn.html">Learn</a></li>
								<li>
									<a class="dropdown-item" href="./games_page.html">Games</a>
								</li>
								<li>
									<a class="dropdown-item" href="./recipe_generator.html"
										>Recipes Generators</a
									>
								</li>
								<li>
									<a class="dropdown-item" href="./main_merchants.html"
										>List of Merchants</a
									>
								</li>
							</ul>
						</li>
						<li><a class="nav-link" href="signup.html">Sign up</a></li>
						<li><a class="nav-link active" href="signin.html">Sign in</a></li>
					</ul>
					<i class="bi bi-list mobile-nav-toggle"></i>
				</nav>
				<!-- .navbar -->
			</div>
		</header>
		<!-- End Header -->

		<main id="main">
			<!-- Sign In Section -->

			<section
				id="login"
				class="d-flex align-items-center"
				style="height: fit-content; margin-top: 5%"
			>
				<div class="container-fluid" id="signin">
					<vue_login_form></vue_login_form>
				</div>
			</section>
			<!-- End Sign In Section -->

			<!-- ======= Special Thanks and Footer Section ======= -->
			<section id="clients" class="clients clients">
				<div class="container">
					<br />
					<h3>Special Thanks to :</h3>
					<div class="row my-4">
						<div class="col-lg-4 col-md-4 col-4">
							<img
								style="height: auto"
								title="SMU"
								src="assets/img/footer/SMU.png"
								class="img-fluid"
								alt=""
								data-aos="zoom-in"
							/>
						</div>
						<div class="col-lg-4 my-auto col-md-4 col-4">
							<img
								src="assets/img/footer/SCIS.webp"
								class="img-fluid"
								alt=""
								data-aos="zoom-in"
								data-aos-delay="300"
							/>
						</div>

						<div class="col-lg-4 my-auto col-md-4 col-4">
							<img
								src="assets/img/footer/prof.png"
								class="img-fluid"
								alt=""
								data-aos="zoom-in"
								data-aos-delay="100"
							/>
						</div>
					</div>
				</div>
				<br />
				&copy; Copyright <strong>Food Vault </strong>. All Rights Reserved
				<br />
				<br />
			</section>
			<!-- Special Thanks and Footer Section -->
		</main>
		<!-- End #main -->

		<a
			href="#"
			class="back-to-top d-flex align-items-center justify-content-center"
			><i class="bi bi-arrow-up-short"></i
		></a>

		<!-- Vendor JS Files -->
		<script src="assets/vendor/aos/aos.js"></script>
		<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
		<script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
		<script src="assets/vendor/purecounter/purecounter.js"></script>
		<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

		<!-- Template Main JS File -->
		<script src="assets/js/main.js"></script>

		<!-- Firebase -->
		<script type="module">
			import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
			import {
				getDatabase,
				ref,
				set,
				get,
				child,
			} from " https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";
			const firebaseConfig = {
				apiKey: "AIzaSyDKC3yvnonrxiGALVjDktGoS_t8y5adUJk",
				authDomain: "foodvault-6d35a.firebaseapp.com",
				databaseURL:
					"https://foodvault-6d35a-default-rtdb.asia-southeast1.firebasedatabase.app",
				projectId: "foodvault-6d35a",
				storageBucket: "foodvault-6d35a.appspot.com",
				messagingSenderId: "863157964884",
				appId: "1:863157964884:web:02b343ccf7a6d780459dc1",
				measurementId: "G-S687X22CVW",
			};

			const app = initializeApp(firebaseConfig);
			const database = getDatabase(app);

			// Vue js
			Vue.component("vue-recaptcha", VueRecaptcha);

			Vue.component("vue_login_form", {
				template: `
				<form method = "POST" action = "signin.php"
					class="border py-5 m-auto"
					@submit.prevent = "Submit"
					:class= "{form_val: formVal}"
				>
					<h1 class="mt-2"> 
						Login to Food Vault</h1>
					<br>
					<label for ="user_input"><h5>Enter your Username</h5></label>
					<div class="form__field">
						<input 
						id="user_input"
						type="text"
						class="form__input" 
						v-model = "user"
						:class = "{empty: !user}"
						/><br>
						<small>Please input your username!</small>
						
					</div>
					<br>
					<label for = "pw"><h5>Enter your password</h5></label>
					<div class="form__field">
						<input
						id="pw"
						:type= "passwordFieldType"
						class="form__input"
						v-model = "pass"
						:class = "{empty: !pass}"
						/>
						<span v-if="passwordFieldType === 'password'"> <i class="far fa-eye-slash" aria-hidden="true" id="eyeslash" @click = "toggle"></i> </span>
						<span v-else><i class= "far fa-eye" aria-hidden="true" id = "eye" @click = "toggle"></i></span>
						<br>
						<small>Please input your password!</small>
						
					</div>
					<br>
					<div
						:class="{recaptcha_fail: !recaptcha}"
					>
						<vue-recaptcha
							sitekey="6LfbTsMcAAAAAE1yuP37PSrBZaZiaEM5XJsugpNW"
							@verify = "verify"
							style = "					
								transform: scale(0.7); 
								-webkit-transform: scale(0.7); 
								transform-origin: 0 0; 
								-webkit-transform-origin: 0 0"
						></vue-recaptcha>
						<small>Please Check!</small>
					</div>

					<br>
					<button class="btn btn-outline-primary">Login</button>
					<br>
					<br>
					<small style = "display:block">{{error}}</small>
				</form>
			`,
				data() {
					return {
						user: "",
						pass: "",
						formVal: false,
						recaptcha: null,
						error: "",
						passwordFieldType: "password"
					};
				},
				methods: {
					verify(response) {
						this.recaptcha = response;
					},

					escape(user) {
						user
							.replace(/&/g, "ysand")
							.replace(/</g, "yslt")
							.replace(/>/g, "ysgt")
							.replace(/"/g, "ysquot")
							.replace(/'/g, "ys39")
							.replace(/#/g, "yshash")
							.replace(new RegExp("\\$", "g"), "ysdollar")
							.replace(new RegExp("\\[", "g"), "ysleft")
							.replace(new RegExp("\\]", "g"), "ysright")
							.replace(new RegExp("\\.", "g"), "ysdot");
					},

					toggle(){
						if(this.passwordFieldType === "password"){
							this.passwordFieldType = "text"
						}

						else{
							this.passwordFieldType = "password"
						}
					},

					Submit() {
						if (this.user && this.pass && this.recaptcha) {
							var user_check = false;
							var pass_check = false;

							// Verify Username and Password
							var bcrypt = dcodeIO.bcrypt;
							var user = escape(this.user);

							const dbRef = ref(getDatabase());
							get(child(dbRef, `credentials/${user}/username`)).then(
								(snapshot) => {
									if (snapshot._node.value_ == user) {
										this.error = "";
										get(child(dbRef, `credentials/${user}/password`)).then(
											(snapshot) => {
												if (
													bcrypt.compareSync(this.pass, snapshot._node.value_)
												) {
													this.error = "";
													sessionStorage.setItem("user", this.user);

													window.location.href = "./merchant-dashboard.html";
												} else {
													this.error = "Incorrect Password";
												}
											}
										);
									} else {
										this.error = "Incorrect Username";
									}
								}
							);
						} else {
							this.formVal = true;
						}
					},
				},
			});
			var signin = new Vue({
				el: "#signin",
			});
		</script>

		<script>

		</script>
	</body>
</html>
