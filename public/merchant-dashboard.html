<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Food Vault - Your page</title>

		<!-- Favicons -->
		<link href="./assets/img/Logo/bar-icon.jpg" sizes="32x32" rel="icon" />

		<!-- Google Fonts -->
		<link
			href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
			rel="stylesheet"
		/>
		<!-- Bootstrap -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
			crossorigin="anonymous"
		/>
		<!-- Vendor CSS Files -->
		<link href="assets/vendor/aos/aos.css" rel="stylesheet" />
		<link
			href="assets/vendor/bootstrap/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
			rel="stylesheet"
		/>
		<link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
		<link
			href="assets/vendor/glightbox/css/glightbox.min.css"
			rel="stylesheet"
		/>
		<link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
		<link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

		<!-- Template Main CSS File -->
		<link href="assets/css/style.css" rel="stylesheet" />

		<!--  Dashboard style sheets -->
		<link href="assets/css/styledashboard.css" rel="stylesheet" />
		<!-- Vue.js -->
		<!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
		<script src="https://unpkg.com/vue@3.2.20/dist/vue.global.prod.js"></script>
	</head>
	<body>
		<!-- ======= Header ======= -->
		<header id="header" class="fixed-top d-flex align-items-center">
			<div class="container d-flex align-items-center justify-content-between">
				<div class="logo">
					<h1><a href="#">Food Vault</a></h1>
				</div>
				<nav id="navbar" class="navbar">
					<ul>
						<li>
							<p id="user"></p>
						</li>
				
						<!-- Profile -->

						<li>
							<a onclick="sessionLogout()" href="#"
								>Logout</a
							>
						</li>
					</ul>

					<i class="bi bi-list mobile-nav-toggle"></i>
				</nav>
				<!-- .navbar -->
			</div>
		</header>

		
		<div class="container-fluid">
			<div class="row" style="background-color: rgb(243, 243, 243)">
				<!-- -----------------------------------------MERCHANT DETAILS STARTS HERE ------------------------------------- -->
				<!-- <div class="col-12 col-lg-3"  >
					<div class="card w-70 shadow" style="margin-top: 100px;height:420px;">
						<div class="card-body text-center">
							
							<p class="lead p-2 fs-6">
								How much food waste you have reduced with Food Vault
							</p>
							<img id="userImg" src="" style="width:100%; height:200px; margin: auto" />
							<p
								id="getAddress"
								class="text-muted "
								style="font-size: 12px"
							></p>
						</div>
					</div>
				</div> -->

				<!-- ------------------------------------DASHBOARD LAYOUT STARTS HERE-------------------------->

				<div class="col" style="margin-top: 100px">
					<!-- cards -->
				<!-- <div class="card-deck mt-5 container"> -->
					<div class="row justify-content-between">
						<div class="col-lg-3 col-md-6 col-sm-6">
							<div class="card h-100 mb-3 shadow">
								<div class="row g-0">
									<div class="col-md">
										<div class="card-body">
											<p class="card-text">
												<small class="text-muted ">No. of receiver</small>
											</p>
											<h5 id="receiver" class="card-title text-center fs-3" style="font-family:sans-serif"></h5>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-lg-3 col-md-6 col-sm-6">
							<div class="card h-100 mb-3 shadow">
								<div class="row g-0">
									<div class="col-md">
										<div class="card-body">
											<p class="card-text">
												<small class="text-muted">No. of food donated</small>
											</p>
											<h5 id="fooddonate" class="card-title text-center fs-3" style="font-family:sans-serif"></h5>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!--  Card 3-->
						<div id="reviews" class="col-lg-3 col-md-6 col-sm-6">
							<div class="card h-100 mb-3 shadow">
								<div class="row">
									<div class="col-md">
										<div class="card-body">
											<p class="card-text">
												<small class="text-muted">No. of kg food saved</small>
											</p>
											<h5 id='kilograms' class="card-title text-center fs-3" style="font-family:sans-serif"></h5>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!--  Card 4-->
						<div id="reviews" class="col-lg-3 col-md-6 col-sm-6">
							<div class="card h-100 mb-3 shadow">
								<div class="row">
									<div class="col-md">
										<div class="card-body">
											<p class="card-text">
												<small class="text-muted">% decrease in food wastage</small>
											</p>
											<h5 id='percentage'class="card-title text-center fs-3" style="font-family:sans-serif"></h5>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- </div> -->
					<!-- --------------------------------------------2 sub Line chart ------------------------------------ -->
					<!-- <div class="container mt-4 mb-5"> -->
					<div class="row my-4">
						<div class="col-lg-6">
							<div class="card card-chart shadow">
								<div class="list-group-item border-light">
									<h4 class="card-title lead">No. of Receiver</h4>
									<p class="fs-6 lead">By Hours</p>
								</div>
								<div class="card-body">
									<div class="chart-area mt-2">
										<canvas id="lineChartExampleWithNumbersAndGrid"></canvas>
									</div>
								</div>
							</div>
						</div>
						
						<!-- Bar chart -->
						<div class="col-lg-6">
							<div class="card card-chart shadow">
								<div class="list-group-item border-light">
									<h4 class="card-title lead">No. of Receiver</h4>
									<p class="fs-6 lead">By Week</p>
								</div>
								<div class="card-body">
									<div class="chart-area mt-2">
										<canvas id="barChartSimpleGradientsNumbers"></canvas>
									</div>
								</div>
							</div>
						</div>
					</div>
				
			</div>
				<!-- ----------------------------------------------------END ROW ------------------------------------------------ -->
				
				<!-- ---------------------------------------------------------BIG Line chart----------------------------------------- -->

				<!-- <h3 class="lead text-center fs-3">Overview<br /></h3> -->
			<div class="row mb-4 p-0 m-0">
				<div class="col mt-2">
					<!-- <h2>Food Donated</h2>
					<h4>by months</h4> -->
					<div class="card card-chart shadow">
						<div class="list-group-item border-light">
							<h3 class="card-title lead text-center">Food Donated <span style="font-size: x-small;">by months</span></h3>
						</div>
						<div class="card-body">
							<div class="panel-header panel-header-lg rounded-3 shadow-lg">
								<canvas id="bigDashboardChart"></canvas>
							</div>
							
						</div>
					</div>

					
				</div>

				<!-- ----------------------------------------------------END COL  ------------------------------------------------ -->
			</div>
		</div>

		<!-- ======= Special Thanks and Footer Section ======= -->
		<section id="clients" class="clients clients">
			<div class="container">
				<br />
				<h3>Special Thanks to :</h3>
				<div class="row my-4">
					<div class="col-lg-4 col-md-4 col-4">
						<img
							style="height: auto"
							title="SMU"
							src="assets/img/footer/SMU.png"
							class="img-fluid"
							alt=""
							data-aos="zoom-in"
						/>
					</div>
					<div class="col-lg-4 my-auto col-md-4 col-4">
						<img
							src="assets/img/footer/SCIS.webp"
							class="img-fluid"
							alt=""
							data-aos="zoom-in"
							data-aos-delay="300"
						/>
					</div>

					<div class="col-lg-4 my-auto col-md-4 col-4">
						<img
							src="assets/img/footer/prof.png"
							class="img-fluid"
							alt=""
							data-aos="zoom-in"
							data-aos-delay="100"
						/>
					</div>
				</div>
			</div>
			<br />
			&copy; Copyright <strong>Food Vault </strong>. All Rights Reserved <br />
			<br />
		</section>

		<!--   Core JS Files   -->
		<script src="assets/js/merchant/core/jquery.min.js"></script>
		<script src="assets/js/merchant/core/popper.min.js"></script>
		<script src="assets/js/merchant/core/bootstrap.min.js"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
			crossorigin="anonymous"
		></script>

		<script src="assets/js/merchant/plugins/perfect-scrollbar.jquery.min.js"></script>

		<!-- Chart JS -->
		<script src="assets/js/merchant/plugins/chartjs.min.js"></script>

		<!-- layout and effects -->
		<script src="assets/js/merchant/merchant-dashboard-data.js"></script>
		<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
		<script
			src="assets/js/merchant/dashboard.min.js"
			type="text/javascript"
		></script>

		<!-- Vendor JS Files -->
		<script src="assets/vendor/aos/aos.js"></script>
		<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
		<script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
		<script src="assets/vendor/php-email-form/validate.js"></script>
		<script src="assets/vendor/purecounter/purecounter.js"></script>
		<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

		<!-- Template Main JS File -->
		<script src="assets/js/main.js"></script>

		<!--  generate random and data when window onload -->
		<script>
			var randomReceiver = 0;
			for (let i = 0; i < 1; i++) {
				randomReceiver += Math.floor(Math.random() * 600000) + 500;
			}
			var randomDonate = 0;
			for (let i = 0; i < 1; i++) {
				randomDonate += Math.floor(Math.random() * 600000) + 500;
			}
			var randomKg = 0;
			for (let i = 0; i < 1; i++) {
				randomKg += Math.floor(Math.random() * 5000) + 200;
			}
			var percentage = 0;
			for (let i = 0; i < 1; i++) {
				percentage += Math.floor(Math.random() * 100);
			}

			// console.log(randomReceiver)
			window.onload = function () {
				document.getElementById("receiver").innerHTML = randomReceiver;
				document.getElementById("fooddonate").innerHTML = randomDonate;
				document.getElementById("kilograms").innerHTML = randomKg + 'kg';
				document.getElementById("percentage").innerHTML = percentage + '%';
				retrieveMerchant();
			};
		</script>

		<!-- Sessions and retrieve data from firebase  -->
		<script>
			$(document).ready(function () {
				data.initDashboardPageCharts();
			});
			// Get value of user from local storage
			var user = sessionStorage.getItem("user");

			// console.log(sessionStorage);
			// Display user if login correct or if there is login else have to redirect back to login
			if (user) {
				document.getElementById(
					"user"
				).innerHTML = `Welcome back  <b>${user.toUpperCase()}<b>`;
				// console.log(user)
			} else {
				window.location.href = "./signin.html";
			}

			// Logout
			function sessionLogout() {
				sessionStorage.clear();
				window.location.href = "./index.html";
			}
		</script>

		<!-- Extract merchants details from firebase -->
		<script type="module">
			import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
			import {
				getDatabase,
				ref,
				set,
				get,
				child,
			} from " https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";
			const firebaseConfig = {
				apiKey: "AIzaSyDKC3yvnonrxiGALVjDktGoS_t8y5adUJk",
				authDomain: "foodvault-6d35a.firebaseapp.com",
				databaseURL:
					"https://foodvault-6d35a-default-rtdb.asia-southeast1.firebasedatabase.app",
				projectId: "foodvault-6d35a",
				storageBucket: "foodvault-6d35a.appspot.com",
				messagingSenderId: "863157964884",
				appId: "1:863157964884:web:02b343ccf7a6d780459dc1",
				measurementId: "G-S687X22CVW",
			};

			const app = initializeApp(firebaseConfig);
			const database = getDatabase(app);
			// console.log(app)
			// match user with merchants username
			var user = sessionStorage.getItem("user");
			// console.log(user)

			// get credential merchant and match with the merchant PK
			window.retrieveMerchant = function retrieveMerchant() {
				const dbRef = ref(getDatabase());
				get(child(dbRef, `credentials/`)).then((testing) => {
					if (testing.exists()) {
						var merchantPK = testing.val()[user].merchant;
						// console.log(merchantPK)
						const dbRef = ref(getDatabase());
						get(child(dbRef, `merchants/` + merchantPK))
							.then((snapshot) => {
								if (snapshot.exists()) {
									// console.log(snapshot.val());
									var address = snapshot.val().address;
									var changeadd = address
										.replace("ysand", "&")
										.replace("yslt", "<")
										.replace("ysgt", ">")
										.replace("ysquot", '"')
										.replace("ys39", "'")
										.replace("yshash", "#")
										.replace(new RegExp("\\$", "g"), "ysdollar")
										.replace(new RegExp("\\[", "g"), "ysleft")
										.replace(new RegExp("\\]", "g"), "ysright")
										.replace(new RegExp("\\.", "g"), "ysdot")
										.replace(new RegExp("\\ysslsh", "g"), "/");
									// console.log(changeadd);
									document.getElementById("getAddress").innerHTML = changeadd;

									var imgURL = snapshot.val().imageurl;
									var changeImg = imgURL
										.replace("ysand", "&")
										.replace("yslt", "<")
										.replace("ysgt", ">")
										.replace("ysquot", '"')
										.replace("ys39", "'")
										.replace("yshash", "#")
										// .replace("ysslshysslsh", "//")
										.replace(new RegExp("\\ysdollar", "g"), "$")
										.replace(new RegExp("\\ysleft", "g"), "[")
										.replace(new RegExp("\\ysright", "g"), "]")
										.replace(new RegExp("\\ysdot", "g"), ".")
										.replace(new RegExp("\\ysslsh", "g"), "/");
									// console.log(changeImg);
									document.getElementById("userImg").src = changeImg;
								} else {
									console.log("No data available");
								}
							})
							.catch((error) => {
								console.error(error);
							});
					}
				});
			};
		</script>
	</body>
</html>
