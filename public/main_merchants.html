<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Food Vault</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script type="module" src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"></script>
    <!-- This is the API from Firebase Realtime Database -->
    <script type="module" src="https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js"></script>


    <!-- Favicons -->
    <link href="./assets/img/Logo/bar-icon.jpg" sizes="32x32" rel="icon" />

    <!--AXIOS-->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet" />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />


</head>

<body onload="retrieve()">
    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top d-flex align-items-center">
        <div class="container d-flex align-items-center justify-content-between">
            <div class="logo">
                <h1><a href="./index.html">Food Vault</a></h1>
                <!-- Uncomment below if you prefer to use an image logo -->
                <!-- <a href="index.html"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->
            </div>
            <nav id="navbar" class="navbar">
                <ul>
                    <li>
                        <a class="nav-link" href="./index.html">Home</a>
                    </li>
                    <li>
                        <a class="nav-link" href="./index.html#about">About</a>
                    </li>
                    <!-- <li><a class="nav-link scrollto" href="#services"></a></li> -->
                    <li>
                        <a class="nav-link" href="./index.html#team">Team</a>
                    </li>
                    <li>
                        <a class="nav-link" href="./index.html#faq">FAQ</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link active dropdown-toggle" href="#services" id="navbarDropdownMenuLink"
                            role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Services
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <li><a class="dropdown-item" href="./learn.html">Learn</a></li>
                            <li>
                                <a class="dropdown-item" href="./games_page.html">Games</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="./recipe_generator.html">Recipes Generators</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="./main_merchants.html">List of Merchants</a>
                            </li>
                        </ul>
                    </li>
                    <li><a class="nav-link" href="signup.html">Sign up</a></li>
                    <li><a class="nav-link" href="signin.html">Sign in</a></li>
                </ul>
                <i class="bi bi-list mobile-nav-toggle"></i>
            </nav>
            <!-- .navbar -->
        </div>
    </header>
    <!-- End Header -->

    <br />

    <!-- jumbotron -->
    <div class="container jumbotron rounded-3 text-center" style="margin-top: 100px; justify-content: center">
        <div class="section-title" data-aos="fade-up">
            <h2>List of Merchants</h2>
        </div>

        <p class="lead fs-6" data-aos="fade-up">
            Head on down to the merchants listed below to collect the free food to reduce food waste and help our mother earth!
            <!-- Here are the different merchants that are working together with FoodVault to reduce food waste and help our
            mother earth! -->
        </p>
    </div>

    <!-- ======= First Section ======= -->
    <section id="home" class="d-flex align-items-center" style="height: fit-content;">

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
            import { getDatabase,ref,set,get,child } from " https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";
            const firebaseConfig = {
               apiKey: "AIzaSyDKC3yvnonrxiGALVjDktGoS_t8y5adUJk",
               authDomain: "foodvault-6d35a.firebaseapp.com",
               databaseURL: "https://foodvault-6d35a-default-rtdb.asia-southeast1.firebasedatabase.app",
               projectId: "foodvault-6d35a",
               storageBucket: "foodvault-6d35a.appspot.com",
               messagingSenderId: "863157964884",
               appId: "1:863157964884:web:02b343ccf7a6d780459dc1",
               measurementId: "G-S687X22CVW"
             };
           
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);
            

            function unescape(htmlStr) {
                //console.log(htmlStr);
                return htmlStr.replace(/ysand/g, "&")
                    .replace(/yslt/g, "<")
                    .replace(/ysgt/g, ">") 
                    .replace(/ysquot/g, '"')
                    .replace(/ys39/g, "'")
                    .replace(/yshash/g, "#")
                    .replace(new RegExp('\\ysdollar', 'g'), '$')
                    .replace(new RegExp('\\ysleft', 'g'), '[')
                    .replace(new RegExp('\\ysright', 'g'), ']')
                    .replace(new RegExp('\\ysdot', 'g'), '.')
                    .replace(new RegExp('\\ysslsh', 'g'), '/')
            }

            window.retrieve = function retrieve() { //retrieve all
            //add window.function to access
            const dbRef = ref(getDatabase());
            get(child(dbRef, `merchants`)) 
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        var counter = 1;

                        snapshot.forEach(function(childSnapshot) {
                        var key = childSnapshot.key;
                        var childData = childSnapshot.val();
                        console.log(childData);
                        
                        var postal = childData.address.slice(-6);
                        console.log(postal);
                        
                        var merchantName= childData.merchant.split("@")[0];
                        merchantName = unescape(merchantName);

                        var description = childData.description;
                        description = unescape(description);

                        var address = childData.address;
                        address = unescape(address);

                        var imageurl = childData.imageurl;
                        imageurl = unescape(imageurl);                  

                        var e = document.getElementById("col" + counter);
                        e.innerHTML =
                            `<div class="card shadow-sm" style="height: 100%;" data-aos="fade-up" data-aos-delay="200">

                                <img id="card-image" style="max-width: 100%; height: 280px;" src="${imageurl}" alt="">

                                    <div class="card-body">
                                        <p id="card-header" style="font-weight: bold;">${merchantName}</p>
                                        <p id="card-description">${description}<br></p>
                                        <p id="card-address" style="font-size: small;">${address}<br><br></p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="btn-group" style="position:absolute; bottom:10px;">
                                            <button type="button" class="btn btn-sm btn-outline-primary"
                                                onclick="viewMore('${merchantName}', '${description}', '${imageurl}', '${postal}', '${address}')">View</button>
                                            </div>
                                        </div>
                                    </div>

                        </div>`;

                        counter += 1;
                    })
                    } else {
                        console.log("No data available");
                    }
                })
                .catch((error) => {
                console.error(error);
            });
        };
        
        </script>

        <body class="align">
            <div class="container-fluid">
                <div class=" px-1 py-4 m-auto">
                    <div class="container">
                        <div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-3 g-3">
                            <div id="col1"></div>
                            <div id="col2"></div>
                            <div id="col3"></div>
                            <div id="col4"></div>
                            <div id="col5"></div>
                            <div id="col6"></div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </body>
        </div>
    </section>

    <script>
        function escape(str) {
            return str
                .replace(/&/g, "ysand")
                .replace(/</g, "yslt")
                .replace(/>/g, "ysgt")
                .replace(/"/g, "ysquot")
                .replace(/'/g, "ys39")
                .replace(/#/g, "yshash")
                .replace(new RegExp("\\$", "g"), "ysdollar")
                .replace(new RegExp("\\[", "g"), "ysleft")
                .replace(new RegExp("\\]", "g"), "ysright")
                .replace(new RegExp("\\?", "g"), "ysqnmark")
                .replace(new RegExp("\\.", "g"), "ysdot");
        }

        function viewMore(header, description, image, postal, address) {
            header = escape(header)
            description = escape(description)
            image = escape(image)
            address = escape(address)
            url = 'individual_merchant.html?header=' + header + "&description=" + description + "&image=" + image +
                "&postal=" + postal + "&address=" + address;
            document.location.href = url;
            console.log(url)
        }
    </script>

    <!-- End First Section -->
    <main id="main">
        <!-- ======= Special Thanks and Footer Section ======= -->
        <section id="clients" class="clients clients">
            <div class="container">
                <br />
                <h3>Special Thanks to :</h3>
                <div class="row my-4">
                    <div class="col-lg-4 col-md-4 col-4">
                        <img style="height: auto" title="SMU" src="assets/img/footer/SMU.png" class="img-fluid" alt=""
                            data-aos="zoom-in" />
                    </div>
                    <div class="col-lg-4 my-auto col-md-4 col-4">
                        <img src="assets/img/footer/SCIS.webp" class="img-fluid" alt="" data-aos="zoom-in"
                            data-aos-delay="300" />
                    </div>

                    <div class="col-lg-4 my-auto col-md-4 col-4">
                        <img src="assets/img/footer/prof.png" class="img-fluid" alt="" data-aos="zoom-in"
                            data-aos-delay="100" />
                    </div>
                </div>
            </div>
            <br />
            &copy; Copyright <strong>Food Vault </strong>. All Rights Reserved
            <br />
            <br />
        </section>
        <!-- Special Thanks and Footer Section -->
    </main>
    <!-- End #main -->

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/purecounter/purecounter.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>




</body>

</html>