<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Food Vault</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script type="module" src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"></script>
    <!-- This is the API from Firebase Realtime Database -->
    <script type="module" src="https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js"></script>

    <!--AXIOS-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Favicons -->
    <link href="./assets/img/Logo/bar-icon.jpg" sizes="32x32" rel="icon" />


    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous">
    </script>

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />


</head>

<body>
    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top d-flex align-items-center">
        <div class="container d-flex align-items-center justify-content-between">
            <div class="logo">
                <h1><a href="./foodvault_intro_v2.html">Food Vault</a></h1>
                <!-- Uncomment below if you prefer to use an image logo -->
                <!-- <a href="index.html"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->
            </div>
            <nav id="navbar" class="navbar">
                <ul>
                    <li>
                        <a class="nav-link" href="./foodvault_intro_v2.html">Home</a>
                    </li>
                    <li>
                        <a class="nav-link" href="./foodvault_intro_v2.html#about">About</a>
                    </li>
                    <!-- <li><a class="nav-link scrollto" href="#services"></a></li> -->
                    <li>
                        <a class="nav-link" href="./foodvault_intro_v2.html#team">Team</a>
                    </li>
                    <li>
                        <a class="nav-link" href="./foodvault_intro_v2.html#faq">FAQ</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link active dropdown-toggle" href="#services" id="navbarDropdownMenuLink"
                            role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Services
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <li><a class="dropdown-item" href="./learn.html">Learn</a></li>
                            <li>
                                <a class="dropdown-item" href="./games_page.html">Games</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="./recipe_generator.html">Recipes Generators</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="./main_merchants.html">List of Merchants</a>
                            </li>
                        </ul>
                    </li>
                    <li><a class="nav-link" href="signup.html">Sign up</a></li>
                    <li><a class="nav-link" href="signin.html">Sign in</a></li>
                </ul>
                <i class="bi bi-list mobile-nav-toggle"></i>
            </nav>
            <!-- .navbar -->
        </div>
    </header>
    <!-- End Header -->

    <!-- ======= First Section ======= -->
    <section id="home" class="d-flex align-items-center" style="height: fit-content;">

        <body class="align">
            <div class="container-fluid">
                <div class=" px-5 py-4 m-auto">

                    <div class="container">
                        <section class="py-5">
                            <div class="container px-4 px-lg-5 my-5" data-aos="fade-up" data-aos-delay="200">
                                <div class="row gx-4 gx-lg-5 align-items-center">
                                    <div class="col-md-6"><img class="card-img-top mb-5 mb-md-0" id="imageUrl" src=""
                                            alt="..." />
                                    </div>
                                    <div class="col-md-6">
                                        <h1 class="display-5 fw-bolder" id="merchantName"></h1>
                                        <p id="description" style="font-size: x-large;"></p>

                                        <div id="floating-panel">
                                            <b>Mode of Travel: </b>
                                            <select id="mode">
                                                <option value="DRIVING">Driving</option>
                                                <option value="WALKING">Walking</option>
                                                <option value="TRANSIT">Public Transport</option>
                                            </select>
                                        </div>
                                        <p id='latLat' hidden></p>
                                        <p id='lngLng' hidden></p>

                                        <br>

                                        <div class="d-flex">
                                            <button class="btn btn-outline-dark flex-shrink-0" type="button"
                                                onclick="getLocation()">Take Me There</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!--The div element for the map -->
                        <div id="map" data-aos="fade-up" data-aos-delay="200"></div>
                        <script>
                            window.onload = function () {
                                var url = document.location.href,
                                    params = url.split('?')[1].split('&'),
                                    data = {},
                                    tmp;

                                for (var i = 0, l = params.length; i < l; i++) {
                                    tmp = params[0].split('=')[1].split('%20');
                                    var header = tmp.join(' ');
                                }
                                for (var i = 0, l = params.length; i < l; i++) {
                                    tmp = params[1].split('=')[1].split('%20');
                                    var description = tmp.join(' ');
                                }
                                for (var i = 0, l = params.length; i < l; i++) {
                                    tmp = params[2].split('=')[1];
                                    var imageUrl = tmp;
                                }
                                for (var i = 0, l = params.length; i < l; i++) {
                                    tmp = params[3].split('=')[1];
                                    var postalCode = tmp;
                                }

                                document.getElementById("merchantName").innerHTML = header;
                                document.getElementById("description").innerHTML = description;
                                document.getElementById("imageUrl").src = imageUrl;
                                geocode(postalCode);
                            }

                            function geocode(postal) {
                                var location = postal;
                                axios.get('https://maps.googleapis.com/maps/api/geocode/json', {
                                        params: {
                                            address: location,
                                            key: 'AIzaSyA2MhoG6uxV9AS8zCdb9tg48nau98kvEpk'
                                        }
                                    })
                                    .then(function (response) {
                                        // Log Full Response
                                        //console.log(response);

                                        //Lat & Long
                                        //console.log(response.data.results[0].geometry.location)
                                        var lat = response.data.results[0].geometry.location.lat;
                                        var lng = response.data.results[0].geometry.location.lng;

                                        document.getElementById("latLat").innerText = lat;
                                        document.getElementById("lngLng").innerText = lng;

                                        initMap();
                                    })
                                    .catch(function (error) {
                                        console.log(error);
                                    })
                            }



                            // Note: This example requires that you consent to location sharing when
                            // prompted by your browser. If you see the error "The Geolocation service
                            // failed.", it means you probably did not give permission for the browser to
                            // locate you.
                            var map, infoWindow;


                            function initMap() {
                                const directionsService = new google.maps.DirectionsService();
                                const directionsRenderer = new google.maps.DirectionsRenderer();

                                const end = {
                                    lat: Number(document.getElementById("latLat").innerText),
                                    lng: Number(document.getElementById("lngLng").innerText)
                                };

                                const map = new google.maps.Map(document.getElementById('map'), {
                                    center: end,
                                    zoom: 17
                                });

                                directionsRenderer.setMap(map);

                                //The marker, position at location
                                const endMarker = new google.maps.Marker({
                                    position: end,
                                    map: map,
                                });



                            }

                            function getLocation() {
                                const directionsService = new google.maps.DirectionsService();
                                const directionsRenderer = new google.maps.DirectionsRenderer();

                                console.log(navigator.geolocation);
                                // this attempts to get user permission to access location
                                // Try HTML5 geolocation.

                                const end = {
                                    lat: Number(document.getElementById("latLat").innerText),
                                    lng: Number(document.getElementById("lngLng").innerText)
                                };

                                if (navigator.geolocation) {
                                    navigator.geolocation.getCurrentPosition(function (position) {
                                        const start = {
                                            lat: position.coords.latitude,
                                            lng: position.coords.longitude
                                        }

                                        const map = new google.maps.Map(document.getElementById('map'), {
                                            center: end,
                                            zoom: 17
                                        });

                                        directionsRenderer.setMap(map);

                                        calculateAndDisplayRoute(directionsService, directionsRenderer,
                                            start, end);

                                        // set user position to infoWindow
                                    }, function () {
                                        handleLocationError(true, infoWindow, map.getCenter());
                                    });
                                } else { // error handling
                                    // Browser doesn't support Geolocation
                                    handleLocationError(false, infoWindow, map.getCenter());
                                }
                            }

                            function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                                infoWindow.setPosition(pos);
                                infoWindow.setContent(browserHasGeolocation ?
                                    'Error: The Geolocation service failed.' :
                                    'Error: Your browser doesn\'t support geolocation.');
                                infoWindow.open(map);
                            }

                            function calculateAndDisplayRoute(directionsService, directionsRenderer, start, end) {

                                const selectedMode = document.getElementById("mode").value;

                                directionsService
                                    .route({
                                        origin: start,
                                        destination: end,
                                        travelMode: google.maps.TravelMode[selectedMode],
                                    })
                                    .then((response) => {
                                        directionsRenderer.setDirections(response);
                                    })
                                    .catch((e) => window.alert("Directions request failed due to " + status));
                            }
                        </script>

                        <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
                        <!-- load the map asynchronously, i.e., load data soon as it becomes available -->
                        <script
                            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA2MhoG6uxV9AS8zCdb9tg48nau98kvEpk">
                        </script>
                    </div>
                </div>
            </div>
        </body>
        </div>
    </section>

    <!-- End First Section -->
    <main id="main">
        <!-- ======= Special Thanks and Footer Section ======= -->
        <section id="clients" class="clients clients">
            <div class="container">
                <br />
                <h3>Special Thanks to :</h3>
                <div class="row my-4">
                    <div class="col-lg-4 col-md-4 col-4">
                        <img style="height: auto" title="SMU" src="assets/img/footer/SMU.png" class="img-fluid" alt=""
                            data-aos="zoom-in" />
                    </div>
                    <div class="col-lg-4 my-auto col-md-4 col-4">
                        <img src="assets/img/footer/SCIS.webp" class="img-fluid" alt="" data-aos="zoom-in"
                            data-aos-delay="300" />
                    </div>

                    <div class="col-lg-4 my-auto col-md-4 col-4">
                        <img src="assets/img/footer/prof.png" class="img-fluid" alt="" data-aos="zoom-in"
                            data-aos-delay="100" />
                    </div>
                </div>
            </div>
            <br />
            &copy; Copyright <strong>Food Vault </strong>. All Rights Reserved
            <br />
            <br />
        </section>
        <!-- Special Thanks and Footer Section -->
    </main>
    <!-- End #main -->

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/purecounter/purecounter.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>




</body>

</html>