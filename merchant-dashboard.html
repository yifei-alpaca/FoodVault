<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Food Vault</title>

		<!-- Favicons -->
		<link href="./assets/img/Logo/bar-icon.jpg" sizes="32x32" rel="icon" />

		<!-- Google Fonts -->
		<link
			href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
			rel="stylesheet"
		/>
		<!-- Bootstrap -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU"
			crossorigin="anonymous"
		/>
		<!-- Vendor CSS Files -->
		<link href="assets/vendor/aos/aos.css" rel="stylesheet" />
		<link
			href="assets/vendor/bootstrap/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
			rel="stylesheet"
		/>
		<link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
		<link
			href="assets/vendor/glightbox/css/glightbox.min.css"
			rel="stylesheet"
		/>
		<link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
		<link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

		<!-- Template Main CSS File -->
		<link href="assets/css/style.css" rel="stylesheet" />

		<!--  Dashboard style sheets -->
		<link href="assets/css/styledashboard.css" rel="stylesheet" />
		<!-- Vue.js -->
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	</head>
	<body onload="retrieveMerchant()">
		<!-- ======= Header ======= -->
		<header id="header" class="fixed-top d-flex align-items-center">
			<div class="container d-flex align-items-center justify-content-between">
				<div class="logo">
					<h1><a href="foodvault_intro.html">Food Vault</a></h1>
				</div>
				<nav id="navbar" class="navbar">
					<ul>
						<li>
							<a class="nav-link" href="./foodvault_intro_v2.html"
								>Home &nbsp; &nbsp;</a
							>
						</li>
						<!-- Notification -->

						<div class="dropdown">
							<li class="nav-item">
								<img src="assets/img/merchant/notification.png" width="30x30" />
							</li>

							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
								<li>
									<a class="dropdown-item" href="#">User0456 leaves a review</a>
								</li>
								<li>
									<a class="dropdown-item" href="#">You have 3 new tasks</a>
								</li>
								<li>
									<a class="dropdown-item" href="#">User0218 leaves a review</a>
								</li>
								<li>
									<a class="dropdown-item" href="#">User0067 leaves a review</a>
								</li>
							</ul>
						</div>
						&nbsp; &nbsp; &nbsp;

						<!-- Profile -->

						<div class="dropdown">
							<li class="nav-item">
								<img src="assets/img/merchant/user.png" width="30x30" />
							</li>

							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
								<!-- <li>
									<a
										data-bs-toggle="offcanvas"
										data-bs-target="#offcanvasRight"
										aria-controls="offcanvasRight"
										>Profile
									</a>

									<div
										class="offcanvas offcanvas-end"
										tabindex="-1"
										id="offcanvasRight"
										aria-labelledby="offcanvasRightLabel"
									>
										<div class="offcanvas-header">
											<h5 id="">Offcanvas right</h5>
											<button
												type="button"
												class="btn-close text-reset"
												data-bs-dismiss="offcanvas"
												aria-label="Close"
											></button>
										</div>
										<div class="offcanvas-body">...</div>
									</div>
								</li> -->

								<li>
									<a class="dropdown-item" onclick="sessionLogout()" href="#"
										>Logout</a
									>
								</li>
							</ul>
						</div>
					</ul>

					<!-- <i class="bi bi-list mobile-nav-toggle"></i> -->
				</nav>
				<!-- .navbar -->
			</div>
		</header>
		<!-- End Header -->

		<!-- jumbotron -->
		<div
			class="container jumbotron rounded-3"
			style="margin-top: 100px; justify-content: center"
		>
		<div class="row">
			
			<div class='col pt-5 mt-3'>
				<h1 class="display-5" id="user"></h1>
				<br>
				<br>
				<p class="lead p-2 fs-6">
					How much have you reduced food waste with Food Vault
				</p>
			</div>
			<div class='col text-center'><img id="userImg" src="" style="width: 400px;"/>
				<p id="getAddress" class=" text-muted x-small"></p>
			</div>

		</div>

			<hr class="my-4" />
		</div>
		

		<!-- FIREBASE VUE  -->
		<!-- <div class="container-fluid" id="merchant_dashboard">
			<vue_dashboard></vue_dashboard> -->
		</div>
					<!-- Line chart -->
					<div class="container">
						<!-- <h3 class="lead text-center fs-3">Overview<br /></h3> -->
						<div class="panel-header panel-header-lg rounded-3 shadow-lg">
							<canvas id="bigDashboardChart"></canvas>
						</div>
					</div>

					<!-- cards -->
					<div class="card-deck mt-5 container">
						<div class="row justify-content-between">
							<div class="col-lg-3 col-md-6 col-sm-6">
								<div class="card mb-3 shadow">
									<div class="row g-0">
										<div class="col-md-7 imgHover1">
											<img
												src="assets/img/merchant/melanie-lim-nD3wunG16Fo-unsplash.jpg"
												class="img-fluid rounded-start"
											/>
										</div>
										<div class="col-md">
											<div class="card-body">
												<p class="card-text">
													<small class="text-muted">No. of receiver</small>
												</p>
												<h5 class="card-title">000000</h5>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- style imgHover -->
							<div
								class="col-lg-3 col-md-6 col-sm-6"
								onclick="document.getElementById('staticBackdropLabel').style.display='block'"
								data-bs-toggle="modal"
								data-bs-target="#staticBackdrop"
							>
								<div class="card mb-3 shadow">
									<div class="row g-0">
										<div class="col-md-7 imgHover2">
											<img
												src="assets/img/merchant/joel-muniz-BErJJL_KsjA-unsplash.jpg"
												class="img-fluid rounded-start"
											/>
										</div>
										<div class="col-md">
											<div class="card-body">
												<p class="card-text">
													<small class="text-muted">No. of food donated</small>
												</p>
												<h5 class="card-title">000000</h5>
											</div>
										</div>
									</div>
								</div>
							</div>

							<!-- Modal -->
							<div
								class="modal fade"
								id="staticBackdrop"
								data-bs-backdrop="static"
								data-bs-keyboard="false"
								tabindex="-1"
								aria-labelledby="staticBackdropLabel"
								aria-hidden="true"
							>
								<div class="modal-dialog modal-dialog-centered">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="staticBackdropLabel">
												Food Donated
											</h5>
											<button
												type="button"
												class="btn-close"
												data-bs-dismiss="modal"
												aria-label="Close"
											></button>
										</div>
										<div class="modal-body">
											<table class="table">
												<thead>
													<tr>
														<th scope="col">Days</th>
														<th scope="col">#</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<th scope="row">Monday</th>
														<td>0000</td>
													</tr>
													<tr>
														<th scope="row">Tuesday</th>
														<td>0000</td>
													</tr>
													<tr>
														<th scope="row">Wednesday</th>
														<td>0000</td>
													</tr>
													<tr>
														<th scope="row">Thursday</th>
														<td>0000</td>
													</tr>
													<tr>
														<th scope="row">Friday</th>
														<td>0000</td>
													</tr>
													<tr>
														<th scope="row">Saturday</th>
														<td>0000</td>
													</tr>
													<tr>
														<th scope="row">Sunday</th>
														<td>0000</td>
													</tr>
												</tbody>
											</table>
										</div>
										<div class="modal-footer">
											<button
												type="button"
												class="btn btn-secondary"
												data-bs-dismiss="modal"
											>
												Close
											</button>
										</div>
									</div>
								</div>
							</div>

							<!--  Card 3 -->
							<div
								class="col-lg-3 col-md-6 col-sm-6"
								onclick="document.getElementById('staticBackdropLabel2').style.display='block'"
								data-bs-toggle="modal"
								data-bs-target="#staticBackdrop2"
							>
								<div class="card mb-3 shadow">
									<div class="row">
										<div class="col-md-7 imgHover3">
											<img
												src="assets/img/merchant/joel-muniz-3k3l2brxmwQ-unsplash.jpg"
												class="img-fluid rounded-start"
											/>
										</div>
										<div class="col-md">
											<div class="card-body">
												<p class="card-text">
													<small class="text-muted">Reviews</small>
												</p>
												<h5 class="card-title">
													4.5/5
													<img
														src="assets/img/merchant/4.5.PNG"
														align="right"
														width="80px"
													/>
												</h5>
											</div>
										</div>
									</div>
								</div>
							</div>

							<!-- Modal Review -->
							<div
								class="modal fade"
								id="staticBackdrop2"
								data-bs-backdrop="static"
								data-bs-keyboard="false"
								tabindex="-1"
								aria-labelledby="staticBackdropLabel2"
								aria-hidden="true"
							>
								<div
									class="
										modal-dialog modal-dialog-centered modal-dialog-scrollable
									"
								>
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="staticBackdropLabel2">
												Reviews from Receiver
											</h5>
											<button
												type="button"
												class="btn-close"
												data-bs-dismiss="modal"
												aria-label="Close"
											></button>
										</div>
										<div class="modal-body">
											<div class="card text-dark mb-3" style="max-width: 30rem">
												<div class="card-header fs-5 bg-transparent">
													User0456
													<img
														src="assets/img/merchant/5.PNG"
														align="right"
														width="100px"
													/>
												</div>
												<div class="card-body bg-light">
													<p class="card-text">
														I'm so glad that they have this service. Their
														service is good & have friendly staff too. Thank
														you.
													</p>
												</div>
											</div>
											<div class="card text-dark mb-3" style="max-width: 30rem">
												<div class="card-header fs-5 bg-transparent">
													User0218
													<img
														src="assets/img/merchant/4.5.PNG"
														align="right"
														width="100px"
													/>
												</div>
												<div class="card-body bg-light">
													<p class="card-text">
														Portion of the food is reasonable, eventho its free
													</p>
												</div>
											</div>
											<div class="card text-dark mb-3" style="max-width: 30rem">
												<div class="card-header fs-5 bg-transparent">
													User0067
													<img
														src="assets/img/merchant/3.5.PNG"
														align="right"
														width="100px"
													/>
												</div>
												<div class="card-body bg-light">
													<p class="card-text text-muted">No comments</p>
												</div>
											</div>
											<div class="card text-dark mb-3" style="max-width: 30rem">
												<div class="card-header fs-5 bg-transparent">
													User1321
													<img
														src="assets/img/merchant/4.PNG"
														align="right"
														width="100px"
													/>
												</div>
												<div class="card-body bg-light">
													<p class="card-text">Good.</p>
												</div>
											</div>
											<div class="card text-dark mb-3" style="max-width: 30rem">
												<div class="card-header fs-5 bg-transparent">
													User0980
													<img
														src="assets/img/merchant/4.5.PNG"
														align="right"
														width="100px"
													/>
												</div>
												<div class="card-body bg-light">
													<p class="card-text">Good Service & friendly staff</p>
												</div>
											</div>
											<div class="card text-dark mb-3" style="max-width: 30rem">
												<div class="card-header fs-5 bg-transparent">
													User2139
													<img
														src="assets/img/merchant/3.5.PNG"
														align="right"
														width="100px"
													/>
												</div>
												<div class="card-body bg-light">
													<p class="card-text text-muted">No comments</p>
												</div>
											</div>
											<div class="card text-dark mb-3" style="max-width: 30rem">
												<div class="card-header fs-5 bg-transparent">
													User0892
													<img
														src="assets/img/merchant/5.PNG"
														align="right"
														width="100px"
													/>
												</div>
												<div class="card-body bg-light">
													<p class="card-text text-muted">No comments</p>
												</div>
											</div>
										</div>
										<div class="modal-footer">
											<button
												type="button"
												class="btn btn-secondary"
												data-bs-dismiss="modal"
											>
												Close
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Line chart -->
					<div class="container mt-4 mb-5">
						<div class="row">
							<div class="col-lg-6">
								<div class="card card-chart shadow">
									<div class="list-group-item border-light">
										<h4 class="card-title lead">No. of Receiver</h4>
										<p class="fs-6 lead">By Hours</p>
									</div>
									<div class="card-body">
										<div class="chart-area">
											<canvas id="lineChartExampleWithNumbersAndGrid"></canvas>
										</div>
									</div>
								</div>
							</div>
							<!-- Bar chart -->
							<div class="col-lg-6">
								<div class="card card-chart shadow">
									<div class="list-group-item border-light">
										<h4 class="card-title lead">No. of Receiver</h4>
										<p class="fs-6 lead">By Week</p>
									</div>
									<div class="card-body">
										<div class="chart-area">
											<canvas id="barChartSimpleGradientsNumbers"></canvas>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

		<!-- ======= Special Thanks and Footer Section ======= -->
		<section id="clients" class="clients clients">
			<div class="container">
				<br />
				<h3>Special Thanks to :</h3>
				<div class="row my-4">
					<div class="col-lg-4 col-md-4 col-4">
						<img
							style="height: auto"
							title="SMU"
							src="assets/img/footer/SMU.png"
							class="img-fluid"
							alt=""
							data-aos="zoom-in"
						/>
					</div>
					<div class="col-lg-4 my-auto col-md-4 col-4">
						<img
							src="assets/img/footer/SCIS.webp"
							class="img-fluid"
							alt=""
							data-aos="zoom-in"
							data-aos-delay="300"
						/>
					</div>

					<div class="col-lg-4 my-auto col-md-4 col-4">
						<img
							src="assets/img/footer/prof.png"
							class="img-fluid"
							alt=""
							data-aos="zoom-in"
							data-aos-delay="100"
						/>
					</div>
				</div>
			</div>
			<br />
			&copy; Copyright <strong>Food Vault </strong>. All Rights Reserved <br />
			<br />
		</section>

		<!--   Core JS Files   -->
		<script src="assets/js/merchant/core/jquery.min.js"></script>
		<script src="assets/js/merchant/core/popper.min.js"></script>
		<script src="assets/js/merchant/core/bootstrap.min.js"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
			crossorigin="anonymous"
		></script>

		<script src="assets/js/merchant/plugins/perfect-scrollbar.jquery.min.js"></script>

		<!-- Chart JS -->
		<script src="assets/js/merchant/plugins/chartjs.min.js"></script>

		<!-- layout and effects -->
		<script src="assets/js/merchant/merchant-dashboard-data.js"></script>
		<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
		<script
			src="assets/js/merchant/dashboard.min.js"
			type="text/javascript"
		></script>

		<!-- Vendor JS Files -->
		<script src="assets/vendor/aos/aos.js"></script>
		<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
		<script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
		<script src="assets/vendor/php-email-form/validate.js"></script>
		<script src="assets/vendor/purecounter/purecounter.js"></script>
		<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

		<!-- Template Main JS File -->
		<script src="assets/js/main.js"></script>

		<script>
			$(document).ready(function () {
				// Javascript method's body can be found in assets/js/demos.js
				data.initDashboardPageCharts();
			});
			// Get value of user from local storage
			var user = sessionStorage.getItem("user");

			// console.log(sessionStorage);
			// Display user if login correct or if there is login else have to redirect back to login
			if (user) {
				document.getElementById(
					"user"
				).innerHTML = `Welcome back  <b>${user.toUpperCase()}<b>`;
				// console.log(user)
			}
			else {
				window.location.href =
					"./signin.html";
			}

			// Logout
			function sessionLogout() {
				sessionStorage.clear();
				window.location.href = "./foodvault_intro_v2.html";
			}
		</script>

		<!-- Extract merchants details from firebase -->
		<script type="module">
			import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
			import {
				getDatabase,
				ref,
				set,
				get,
				child,
			} from " https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";
			const firebaseConfig = {
				apiKey: "AIzaSyDKC3yvnonrxiGALVjDktGoS_t8y5adUJk",
				authDomain: "foodvault-6d35a.firebaseapp.com",
				databaseURL:
					"https://foodvault-6d35a-default-rtdb.asia-southeast1.firebasedatabase.app",
				projectId: "foodvault-6d35a",
				storageBucket: "foodvault-6d35a.appspot.com",
				messagingSenderId: "863157964884",
				appId: "1:863157964884:web:02b343ccf7a6d780459dc1",
				measurementId: "G-S687X22CVW",
			};

			const app = initializeApp(firebaseConfig);
			const database = getDatabase(app);
			// console.log(app)
			// match user with merchants username
			var user = sessionStorage.getItem("user");
			// console.log(user)

			// get credential merchant and match with the merchant PK
			window.retrieveMerchant = function retrieveMerchant() {
				const dbRef = ref(getDatabase());
				get(child(dbRef, `credentials/`)).then((testing) => {
					if (testing.exists()) {
						var merchantPK = testing.val()[user].merchant;
						// console.log(merchantPK)
						const dbRef = ref(getDatabase());
						get(child(dbRef, `merchants/` + merchantPK))
							.then((snapshot) => {
								if (snapshot.exists()) {
									console.log(snapshot.val());
									var address = snapshot.val().address;
									var changeadd = address
										.replace("ysand", "&")
										.replace("yslt", "<")
										.replace("ysgt", ">")
										.replace("ysquot", '"')
										.replace("ys39", "'")
										.replace("yshash", "#")
										.replace(new RegExp("\\$", "g"), "ysdollar")
										.replace(new RegExp("\\[", "g"), "ysleft")
										.replace(new RegExp("\\]", "g"), "ysright")
										.replace(new RegExp("\\.", "g"), "ysdot")
										.replace(new RegExp("\\ysslsh", "g"), "/");
									// console.log(changeadd);
									document.getElementById("getAddress").innerHTML = changeadd;

									var imgURL = snapshot.val().imageurl;
									var changeImg = imgURL
										.replace("ysand", "&")
										.replace("yslt", "<")
										.replace("ysgt", ">")
										.replace("ysquot", '"')
										.replace("ys39", "'")
										.replace("yshash", "#")
										// .replace("ysslshysslsh", "//")
										.replace(new RegExp("\\ysdollar", "g"), "$")
										.replace(new RegExp("\\ysleft", "g"), "[")
										.replace(new RegExp("\\ysright", "g"), "]")
										.replace(new RegExp("\\ysdot", "g"), ".")
										.replace(new RegExp("\\ysslsh", "g"), "/");
									// console.log(changeImg);
									document.getElementById("userImg").src = changeImg;
								} else {
									console.log("No data available");
								}
							})
							.catch((error) => {
								console.error(error);
							});
					}
				});
			};
		</script>
	</body>
</html>
